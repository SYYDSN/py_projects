<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>履历信息</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/index.css">
    <link rel="stylesheet" href="/static/css/LCalendar.min.css">
    <link rel="stylesheet" href="/static/css/pickout.min.css">
    <link rel="stylesheet" href="/static/css/jquery-weui.min.css">
    <link rel="stylesheet" href="/static/css/weui.min.css">
</head>
<script src="/static/js/jquery.js"></script>
<script>
    $(function(){
                let url_head = location.search;
               if(url_head) {
                   $(".submit").css({
                       display: "none"
                   });
               }else{
                   $(".modify").css({
                       display:"none"
                   })
               }
        })
</script>
<style>
        .div_info_btn{
            position: relative;
            bottom: 0;
            margin-bottom: 1em;
        }
        .div_info_btn p{
            margin-top: 20px;
            text-align: center;
            border: 1px solid #ccc;
            line-height: 2.5em;
            border-radius: 6px;
        }
        #times{
            width: 30% !important;
            margin-top: 34px;
        }
        .time_inp{
            width: 30% !important;
            margin-top: 34px;
        }
        .p_alert{
        width: 100%;
        /* position: relative; */
        }
        .pk-input{
            line-height: 6em;
            margin-top: 1.7em;
        }
        .pk-arrow {
            margin: 0 auto;
            line-height: 195%;
        }
        .inp_widh{
            width: 30% !important;
            margin-top: 2.1em;
        }
        .dele{
            text-align: center;
            width: 100% !important;
            position: relative;
            display: inline-block;
            height: 3em;
        }
        .dele i{
            text-align: center;
            width: 3em;
            height: 3em;
            color: red;
            line-height: 3em;
            font-size: 1rem;
        }
    </style>
<body>

        <div class="container-fluid">
                <div class="row">
                        <span id="resume_id" style="display:none">{{ user.resume_id }}</span>
                    <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 div_info xian">
                        <p><input id="enterprise_name" value="{{work['enterprise_name']}}" class="inp_add" type="text" placeholder="公司名称"></p>
                    </div>
                    <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 div_info xian">
                        <p>
                            工作开始时间
                            <i class="glyphicon glyphicon-menu-right pull-right"></i>
                            <input class="inp_add pull-right time_inp" id="begin" value="{{ work.begin }}"  type="text" readonly="" placeholder="日期选择" data-lcalendar="2016-05-11,2016-05-11" />
                        </p>
                    </div>
                    <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 div_info xian">
                            <p>工作结束时间
                                <i class="glyphicon glyphicon-menu-right pull-right"></i>
                                <input class="pull-right time_inp inp_add" value="{{ work.end }}" id="end" type="text" readonly="" placeholder="日期选择" data-lcalendar="2016-05-11,2016-05-11" />
                            </p>
                    </div>
                    <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 div_info xian">
                            <p class="p_alert"> 
                                <select name="state" id="state" class="state pickout inps" placeholder="{{ work.vehicle_type }}">
                                        <option value="pe">小型轿车</option>
                                        <option value="pb">小型客车</option>
                                        <option value="ba">中型客车</option>
                                        <option value="sp">大型客车</option>
                                        <option value="qd">平板式货车</option>
                                        <option value="qd">栏板式货车</option>
                                        <option value="qd">厢式货车</option>
                                        <option value="qd">仓栅式货车</option>
                                        <option value="qd">罐式车</option>
                                        <option value="qd">自卸车</option>
                                        <option value="qd"></option>
                                </select>
                            </p>
                    </div>
                    
                    <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 div_info xian">
                        <p><input id="vehicle_load" class="inp_add inp_load" value = "{{ work.vehicle_load }}" type="text" placeholder="吨位"></p>
                    </div>
                    <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 div_info xian">
                        <p><input id="description" class="inp_add" 苏秦秦value="{{work.description}}" type="text" placeholder="工作描述">
                        </p>
                    </div>
                    <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 div_info div_info_btn">
                        <a href="javascript:;" id="submit" class="submit"> <p>完成</p></a>
                        <a href="javascript:;" id="modify" class="modify"> <p>修改</p></a>
                        <a id="delete" class="dele" href="javascript:;"><i class="glyphicon glyphicon-trash"></i></a>
                    </div>
                </div>
            </div>
        <script src="/static/js/jquery.js"></script>
        <script src="/static/js/bootstrap.min.js"></script>
        <script src="/static/js/LCalendar.min.js"></script>
        <script src="/static/js/pickout.min.js"></script>
        <script src="/static/js/jquery-weui.min.js"></script>
        <script src="/static/js/wexin.js"></script>
        <script src="/wx/js_sdk_init?debug=0&api=chooseImage uploadImage"></script>
        <script>
            pickout.to({
			el:'.state',
			theme: 'clean',
		    });
            let $pk_input = $('.pk-input');
            $pk_input.attr('id','vehicle_type');
            $pk_input.addClass('inp_add');
            $('.txt').append('<input type="text">');
        </script>
        <script>
            var lcalendar = new LCalendar();
            lcalendar.init({
                'trigger': '#begin', //标签id
                'type': 'date', //date 调出日期选择 datetime 调出日期时间选择 time 调出时间选择 ym 调出年月选择,
                'minDate': '1900-1-1', //最小日期
                'maxDate': '2022-1-1'
            });
            var lcalendar2 = new LCalendar();
            lcalendar2.init({
                'trigger': '#end', //标签id
                'type': 'date', //date 调出日期选择 datetime 调出日期时间选择 time 调出时间选择 ym 调出年月选择,
                'minDate': '1900-1-1', //最小日期
                'maxDate': '2022-1-1'
            });
        </script>
        <script>
             function submit(class_name){
                let doms = $(`.${class_name}`);
                let args = {};
                let is_null = false;
                for(let dom of doms){
                    let obj = $(dom);
                    let tag_name = obj[0].tagName.toLowerCase();
                    let arg_name = obj.attr('id');
                    if(tag_name == 'input'){
                        let val = $.trim(obj.val());
                        if(val){
                            args[arg_name] =val;
                            is_null = true;
                        };
                    };
                };
                return is_null? args:null;
            };
            function nans(args){
                let is_null = false;
                let args_nans = {};
                    if(isNaN(args)){
                        is_null = false;
                    }
                    else{
                        is_null = true;
                    }
                return is_null? args_nans:null;
            }
            // 添加时
            $('#submit').on('touchstart', function(){
                let args = submit("inp_add");
                let b;
                if(!$(".inp_load").val()){
                    b = false;
                }else{
                    b = args['vehicle_load'];
                }
                let args_nan = nans( b );
                
                if(args && args_nan){
                    var resume_id = $("#resume_id").text();
                    args['resume_id'] = resume_id;
                    args['opt'] = "add_work";
                    $.post("/wx/resume/extend", args, function(resp){
                        let json = JSON.parse(resp);
                        if(json['message'] == 'success'){
                            alert('保存成功！');
                            location.href = '/wx/html/resume.html';
                        }else{
                            alert('保存失败');
                        }
                    }) 
                }else{
                    alert('提交信息失败！');
                }
            });
            //  修改
            $('#modify').on('touchstart', function(){
                let args = submit("inp_add");
                let b;
                if(!$(".inp_load").val()){
                    b = false;
                }else{
                    b = args['vehicle_load'];
                }
                let args_nan = nans( b );
                if(args && args_nan){
                    var resume_id = $("#resume_id").text();
                    let url_head = location.search; //获取url中含"?"符后的字串
                    let work_id = url_head.substring(6); //履历id
                    args['work_id'] = work_id;
                    args['resume_id'] = resume_id;
                    args['opt'] = "update_work";
                    $.post("/wx/resume/extend", args, function(resp){
                        let json = JSON.parse(resp);
                        if(json['message'] == 'success'){
                            alert('修改成功！');
                            location.href = '/wx/html/resume.html';
                        }else{
                            alert('修改失败');
                        }
                    }) 
                }else{
                    alert('未修改信息');
                }
            });
        </script>
        <!-- 微信 提示 删除按钮-->
        <script>
            $("#delete").on("touchstart",function(){
                $.confirm("您确定删除本条信息？",function(){
                    // 删除操作
                    let url_head = location.search; //获取url中含"?"符后的字串
                    let work_id = url_head.substring(6);
                    let args = {};
                    var resume_id = $("#resume_id").text();
                    // let work_id = $("#work_id").text();
                    args['resume_id'] = resume_id;
                    args['work_id'] = work_id;
                    args["opt"] = "delete_work";
                    $.post("/wx/resume/extend", args, function(resp){
                        let json = JSON.parse(resp);
                        if(json['message'] == 'success'){
                            $.toast("删除成功！");
                            setTimeout(function(){location.href = '/wx/html/resume.html';},1000);
                        }else{
                            alert('删除失败！');
                        }
                    })
                    
                },function(){ 
                    //取消c操作
                })
            })
        </script>
</body>
</html>