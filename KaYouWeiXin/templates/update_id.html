<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>上传身份证</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
</head>
<style>
        *{
            margin: 0;
            padding: 0;
            font-size: 14px;
        }

        p{
            margin: 0;
        }
        .div_info p{
            line-height: 4em;
        }
        .xian{
            border-bottom:1px solid #ccc; 
        }
        .text_cen p{
            text-align: center;
        }
        .div_info p input{
            outline: none;
            border: none;
            height: 100%;
            width: 100%;
        }
        .div_info a{
            width: 45px;
        }
        .div_info_btn{
            margin-bottom: 2em;
        }
        .div_info_btn p{
            margin-top: 20px;
            text-align: center;
            border: 1px solid #ccc;
            line-height: 2.5em;
            border-radius: 6px;
            background: #417FFF;
            color: #Fff;
        }
        .div_info_p{
            text-align: center;
        }
        .div_info p img{
            width: 88%;
            height: 16em;
            pointer-events: none;
        }
        .p_mag {
            margin-top: 1em;
        }
    </style>
<body>
        <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 div_info div_info_p ">
                        <p class="p_mag"><img class="imgs" id="id_image_face" src="/static/images/poto.png" alt=""></p>
                        <p>请上传身份证正面照</p>
                    </div>
                <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 div_info div_info_p">
                        <p class="p_mag"><img class="imgs" id="id_image_back" src="/static/images/poto.png" alt=""></p>
                        <p>请上传身份证反面照</p>
                </div>
                    <div id="res"></div>
                <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 div_info div_info_btn">
                        <a id="submit" href="javascript:;"><p>完成</p></a>
                </div>
                </div>
            </div>
        <script src="/static/js/jquery.js"></script>
        <script src="/static/js/bootstrap.min.js"></script>
        <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
        <script src="/wx/js_sdk_init?debug=0&api=chooseImage uploadImage"></script>
        <!--<script src="/static/js/wx_custom.js"></script>-->
    <script>
    $(function(){
        var id_image_face_num = -1;
        var id_image_back_num = -1;
        function photo_img($obj){
            wx.chooseImage({
            count: 1, // 默认9
            sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
            sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
            success: function (res) {
           //  alert(res.localIds);
                    var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
                    $obj.attr('src',localIds);
                    if($obj.attr("id") == "id_image_face"){
                        id_image_face_num = localIds;
                    }
                    else{
                        id_image_back_num = localIds;
                    }
                }
            });
            /*
            wx.getLocalImgData({
                localId: '', // 图片的localID
                success: function (res) {
                    alert(res.localData);
                var localData = res.localData; // localData是图片的base64数据，可以用img标签显示
                     alert(localData);

                }
               });
           */     
        }
        
        // 点击选择事件
        $(".p_mag").each(function(){
            var $this = $(this);
            $this.click(function(){
                var img = $this.find("img:first");
                photo_img(img);
            });
        });
        
        // 上传事件
        $("#submit").click(function(){
                var server_ids = {};
                if(id_image_face_num != -1){
                        wx.uploadImage({
                        localId: id_image_face_num,
                        isShowProgressTips: 1,
                        success: function(res){
                            var id = res.serverId;
                            alert(id);
                            server_ids['id_image_face'] = id;
                        }
                    });
                }
                if(id_image_back_num != -1){
                        wx.uploadImage({
                        localId: id_image_back_num,
                        isShowProgressTips: 1,
                        success: function(res){
                            var id = res.serverId;
                            alert(id);
                            server_ids['id_image_back'] = id;
                        }
                    });
                }
                if(server_ids['id_image_face'] != undefined || server_ids['id_image_back_num']){
                    var args = {
                        "table_name": "id_image",
                        "db": "mongo_db2"
                    };
                    if(server_ids['id_image_face'] != undefined){
                        args['server_id_a'] = server_ids['id_image_face'];
                    }
                    if(server_ids['id_image_back'] != undefined){
                        args['server_id_b'] = server_ids['id_image_back'];
                    }
                    $.post("/wx/")
                }

            
            
        });
        
        
    // end!
    });
    </script>
</body>
</html>